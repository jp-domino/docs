"use strict";(self.webpackChunkflojoy_doc=self.webpackChunkflojoy_doc||[]).push([[3058],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>u});var o=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=o.createContext({}),c=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},p=function(e){var t=c(e.components);return o.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},f=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),f=c(n),u=r,m=f["".concat(l,".").concat(u)]||f[u]||d[u]||i;return n?o.createElement(m,a(a({ref:t},p),{},{components:n})):o.createElement(m,a({ref:t},p))}));function u(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,a=new Array(i);a[0]=f;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,a[1]=s;for(var c=2;c<i;c++)a[c]=n[c];return o.createElement.apply(null,a)}return o.createElement.apply(null,n)}f.displayName="MDXCreateElement"},29899:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>i,metadata:()=>s,toc:()=>c});var o=n(87462),r=(n(67294),n(3905));const i={sidebar_position:2,id:"FEEDBACK",title:"FEEDBACK"},a=void 0,s={unversionedId:"nodes/generators/simulation/FEEDBACK",id:"nodes/generators/simulation/FEEDBACK",title:"FEEDBACK",description:"Before we get into another common version of looping, it is worth while now to mention the feedback node. Often in iterating, it is necessary to retrieve the result of a node in its most recent iteration. As we will flush out in more detail later with an example, we may wish to retrieve the most recent value from a subtraction operation in the last iteration of the loop, for example, to compare two different values and assess if we continue looping or not.",source:"@site/docs/nodes/generators/simulation/FEEDBACK.md",sourceDirName:"nodes/generators/simulation",slug:"/nodes/generators/simulation/FEEDBACK",permalink:"/nodes/generators/simulation/FEEDBACK",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,id:"FEEDBACK",title:"FEEDBACK"},sidebar:"main",previous:{title:"SKLEARN_IMAGES",permalink:"/nodes/generators/Images/SKLEARN_IMAGES"},next:{title:"TIME_SERIES",permalink:"/nodes/generators/simulation/TIME_SERIES"}},l={},c=[{value:"Accessing Redis",id:"accessing-redis",level:3}],p={toc:c};function d(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,o.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Before we get into another common version of looping, it is worth while now to mention the ",(0,r.kt)("inlineCode",{parentName:"p"},"feedback")," node. Often in iterating, it is necessary to retrieve the result of a node in its most recent iteration. As we will flush out in more detail later with an example, we may wish to retrieve the most recent value from a subtraction operation in the last iteration of the loop, for example, to compare two different values and assess if we continue looping or not. "),(0,r.kt)("p",null,"The structure of the node requires a bit of knowledge on how Flojoy stores data internally. We mention ",(0,r.kt)("a",{parentName:"p",href:"/getting-started/architecture"},"here")," briefly that Redis is used as an internal datastore for Flojoy. Here, we flush out how we might retrieve data from Redis in real time."),(0,r.kt)("h3",{id:"accessing-redis"},"Accessing Redis"),(0,r.kt)("p",null,"To create a node that can query the Redis db, our node will need to get some environment variables set at the boot of Flojoy, namely the host and port of the Redis instance."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"import os\nfrom redis import Redis\n\n#this retrives the host name of the Redis server, \n#and defaults to localhost should it not be defined...\nREDIS_HOST = os.environ.get('REDIS_HOST', 'localhost')\n\n#...while this gets the port Redis is running on,\n#and has a default value likewise\nREDIS_PORT = os.environ.get('REDIS_PORT', 6379)\n")),(0,r.kt)("p",null,"Now that we can access the Redis db, we need access to the job itself, the computation sent to Flojoy to be executed by the node of interest. To do this, we import some help from the ",(0,r.kt)("inlineCode",{parentName:"p"},"rq")," library. By passing in a parameter ",(0,r.kt)("inlineCode",{parentName:"p"},"referred_node")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"feedback"),", we get the job id of the node which has the history we are interested in using."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"from rq.job import Job, NoSuchJobError\nreferred_node = params['referred_node']\ntry:\n    job = Job.fetch(referred_node, connection=Redis(\n        host=REDIS_HOST, port=REDIS_PORT))\n    y = job.result.y\nexcept (Exception, NoSuchJobError):\n    print(traceback.format_exc())\n    pass\n\n")),(0,r.kt)("p",null,"Putting this altogether, we get the builtin ",(0,r.kt)("inlineCode",{parentName:"p"},"feedback")," node:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python",metastring:"{title='feedback.py'}","{title":"'feedback.py'}"},"from flojoy import flojoy, DataContainer\nimport os\nfrom redis import Redis\nfrom rq.job import Job, NoSuchJobError\nimport traceback\nREDIS_HOST = os.environ.get('REDIS_HOST', 'localhost')\nREDIS_PORT = os.environ.get('REDIS_PORT', 6379)\n\n\n@flojoy\ndef FEEDBACK(v, params):\n    referred_node = params['referred_node']\n\n    x = v[0].y\n\n    try:\n        job = Job.fetch(referred_node, connection=Redis(\n            host=REDIS_HOST, port=REDIS_PORT))\n        y = job.result.y\n    except (Exception, NoSuchJobError):\n        y = v[0].y if len(v) > 0 else [1, 2, 3]\n        print(traceback.format_exc())\n        pass\n\n    return DataContainer(x=x, y=y)\n")),(0,r.kt)("p",null,"We'll use the feedback node in an example soon."))}d.isMDXComponent=!0}}]);